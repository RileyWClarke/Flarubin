import numpy as np
from astropy import units as u
from astropy import constants as c
from astropy.coordinates import EarthLocation

WAVELENGTH = np.arange(0,12001,1)
WMIN = 3825
WMAX = 9200
MDSPEC = '/Users/riley/Desktop/RAFTS/sdsstemplates/m5.active.ha.na.k.fits'
AMS = np.linspace(1.05,1.2,num=6,dtype='float')

### CTIO weather conditions
RH = 0.0 #relative humidity (percent)
TEMPERATURE = 15 + 273.15 #surface air temp (Kelvin)
P_S = 760 #surface pressure (millibar)

BETA = 4.5908e-6 * TEMPERATURE
CHI = 1 + 5.302e-3 * np.sin(np.deg2rad(EarthLocation.of_site('Cerro Tololo').lat.value))**2 - \
      5.83e-6 * np.sin(np.deg2rad(2 * EarthLocation.of_site('Cerro Tololo').lat.value))**2 - 3.15e-7 * EarthLocation.of_site('Cerro Tololo').height.value

P_W = RH * 1e-4 * np.exp(77.345 + 0.0057 * TEMPERATURE - (7235 / TEMPERATURE)) / TEMPERATURE**8.2
D_W = (1 + P_W * (1 + 3.7e-4 * P_W) * (-2.37321e-3 + (2.23366 / TEMPERATURE) - (710.792 / TEMPERATURE**2) + (7.75141e4 / TEMPERATURE**3))) * (P_W / TEMPERATURE)
D_S = (1 + (P_S - P_W) * (57.90e-8 - (9.3250e-4 / TEMPERATURE) + (0.25844 / TEMPERATURE**2))) * ((P_S - P_W) / TEMPERATURE)

AM =  np.array([1.46071187, 1.46383532, 1.46696313, 1.4701134 , 1.47325367,
       1.47644162, 1.47972646, 1.48297042, 1.48629275, 1.48949247,
       1.49289569, 1.49621113, 1.49956752, 1.50292117, 1.50630044,
       1.50972821, 1.51323743, 1.51670154, 1.52018407, 1.52369808,
       1.52722673, 1.53077701, 1.53434693, 1.53785739, 1.54148284,
       1.54508301, 1.54880347, 1.55260932, 1.55638765, 1.56019322,
       1.56392776, 1.56760547, 1.57134818, 1.575136  , 1.57902216,
       1.58298778, 1.58688571, 1.59078537, 1.59485041, 1.59882875,
       1.6028305 , 1.6068912 , 1.61097471, 1.6150698 , 1.61919505,
       1.62346431, 1.62762555, 1.63188249, 1.6361399 , 1.64049296,
       1.64482594, 1.64925459, 1.65361239, 1.6580181 , 1.6624244 ,
       1.66693561, 1.67142261, 1.67604518, 1.68070194, 1.68524247,
       1.68981158, 1.694539  , 1.69922954, 1.70404494, 1.70876083,
       1.71348053, 1.71828197, 1.7231769 , 1.72809362, 1.73293621,
       1.73788664, 1.74284825, 1.74787617, 1.75291492])

deg2rad = np.pi / 180
ha2deg = 15.0

def get_img_string(key):
    codes={'flare1ep1':'20200206287824000819zg13o2',
           'flare1ep3':'20200206302627000819zg13o2',
           'flare2ep1':'20190418224780000864zg08o3',
           'flare3ep1':'20180402425405000864zg10o2'
    }
    return codes[key]

def get_flr_coord(key):
    coords = {'flare1':[186.09002468556912, 65.31234685437119],
              'flare2':[239.9337200957272, 75.04305873103452],
              'flare3':[255.0794984723742, 78.31401820936068]}
    return coords[key]

batoid_trace = np.array([[4000, 4200,4400,4600,4800, 5100, 5300, 5500],[-4.7265763558433775, 
                         -2.6427375813610112, 
                         -1.0704452846444354, 
                         0.029975162321676407, 
                         0.9870705151456214, 
                         2.0014959056264345, 
                         2.528961277402921,
                         2.9450944784608026]])

batoid_params = np.array([-5.26219831e-08,  5.85778052e-04, -1.58081754e+00])

linenames = ['Ca II H', 'Ca II K', r'H$\delta$', r'H$\gamma$', r'H$\beta$']

linedict = {'Ca II H': np.array([2.39550000e-13, 3.93184712e+03, 5.51710509e+00]),
 'Ca II K': np.array([4.52232596e-13, 3.96757926e+03, 7.61958415e+00]),
 'H$\\delta$': np.array([3.88426913e-13, 4.10018988e+03, 7.61420211e+00]),
 'H$\\gamma$': np.array([4.10208099e-13, 4.33913340e+03, 8.00815074e+00]),
 'H$\\beta$': np.array([3.88398001e-13, 4.86003526e+03, 8.02575104e+00])}

Nribbon_trace = np.array([45.00115718664379, 45.16197805412603, 45.327404903856, 45.5571227670819, 45.67435753566645, 45.89829781259348, 46.01980165137996, 46.303480835130095, 46.420867365897436, 46.724211134482765, 47.16013358714378, 47.51027550122559, 47.81333699215094, 48.12555884842957, 48.450902821843265, 48.76494278907174, 49.09218682501398, 49.38850931621247, 50.0598536137396, 50.37721565514938, 50.86704175870516, 51.181843572091246, 51.676822001752804, 51.98528926162918, 52.282139126412865, 52.61350426442881, 53.08308529280022, 53.567006329823585, 53.88395861333983, 54.21897363185191, 54.529700630630046, 54.85386920593802, 55.16002057490499, 55.66542203128066, 56.1608071835921, 56.464671496464405, 56.96516648147043, 57.272140401468135, 57.62295841607428, 58.109957190164664, 58.585725562728484, 59.07227663837963, 59.56122555651888, 59.91457648195582, 60.213276327747735, 60.556612466742266, 61.07807036205727, 61.40425585677454, 62.404911949984445, 62.90626287370141, 63.47565333682926, 63.981983577763614, 64.4605990088766, 64.93524737653141, 65.38348608913685, 65.88333912010967, 66.35843670382556, 66.82493847750813, 67.14709620389411, 67.62647348116471, 68.0982444378338, 68.59436108386629, 69.0498176058853, 69.52125165050859, 69.855143628868, 70.31708343133587, 70.791455591818, 71.2602155867805, 71.75196451719226, 72.22388116555683, 72.69811674007445, 73.17180293549038, 73.65927217234741, 52.11702187153579, 54.04114477654422, 49.735084060187766],
                         [14.489745939358778, 16.983643654392754, 18.17659305835022, 21.432704438449388, 19.786556147980377, 22.401168865003076, 24.227041869598008, 26.223810594645908, 30.043444215824945, 31.538913618698324, 32.23303464671939, 33.01716453059224, 33.76975810852483, 34.26463101716306, 34.11052405790902, 35.50780020592846, 35.540821032928775, 36.817157547483305, 38.86883401858142, 39.671354383744294, 40.34331502830967, 42.07974563903626, 41.966228610871624, 42.84326802661492, 45.98714180130516, 46.885140310435816, 47.133309258699036, 46.70813070719604, 46.633689789303, 49.85803046539979, 50.94542749201154, 51.68310749324213, 53.68991138532429, 54.601348716682814, 53.84597654505558, 54.44131343977447, 54.46124704164008, 54.243608440967215, 55.0646462530371, 55.54316013025695, 56.192159531321074, 57.68902555598121, 58.71638737893401, 58.7937680391894, 59.95261740840224, 60.06414205303891, 60.025607988285955, 59.836106921652686, 59.90131353255703, 59.940365226363824, 60.142665403847104, 60.41050913944902, 61.07611661987251, 61.38616665653383, 61.42729374984892, 61.380428787305, 61.41770296247409, 61.85130031104134, 61.9015786953648, 61.86198495603937, 61.898912417408255, 61.81112057656063, 61.768982641602676, 61.70412274449854, 61.80630564970137, 61.84050335030521, 61.928573538851595, 62.028129232441565, 62.07010113543886, 62.23877984088766, 61.972239944506256, 62.042071033844394, 62.079018028385114, 44.491789597462834, 48.18308051304852, 37.26123444274424])

